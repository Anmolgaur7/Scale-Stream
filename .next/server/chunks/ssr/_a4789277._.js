module.exports=[35134,a=>{"use strict";let b=(0,a.i(70106).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);a.s(["default",()=>b])},41479,a=>{"use strict";var b=a.i(35134);a.s(["VideoIcon",()=>b.default])},77644,a=>{"use strict";var b=a.i(87924),c=a.i(38246),d=a.i(41479);let e=(0,a.i(70106).default)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var f=a.i(40695),g=a.i(69240),h=a.i(50944);function i({user:a}){let i=(0,h.useRouter)(),j=async()=>{let a=(0,g.createClient)();await a.auth.signOut(),i.push("/"),i.refresh()};return(0,b.jsx)("header",{className:"border-b border-border/50 bg-background/50 backdrop-blur-sm",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,b.jsxs)("nav",{className:"flex items-center justify-between",children:[(0,b.jsxs)(c.default,{href:"/dashboard",className:"flex items-center gap-2",children:[(0,b.jsx)(d.VideoIcon,{className:"h-8 w-8 text-primary"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:"ScaleStream"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:a.email}),(0,b.jsxs)(f.Button,{variant:"ghost",size:"sm",onClick:j,children:[(0,b.jsx)(e,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})})})}a.s(["DashboardHeader",()=>i],77644)},64791,a=>{"use strict";var b=a.i(35134);a.s(["Video",()=>b.default])},42093,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(40695),e=a.i(5522),f=a.i(17171);let g=(0,a.i(70106).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var h=a.i(64791),i=a.i(96221),j=a.i(69240);function k({userId:a}){let[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(""),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),s=(0,c.useRef)(null),t=async()=>{if(!k||!m)return void r("Please select a file and enter a title");p(!0),r(null);try{let b=(0,j.createClient)(),c=k.name.split(".").pop(),d=`${a}/${Date.now()}.${c}`,{error:e}=await b.storage.from("videos").upload(d,k,{cacheControl:"3600",upsert:!1});if(e)throw e;let{data:f,error:g}=await b.from("videos").insert({user_id:a,title:m,original_filename:k.name,file_size:k.size,mime_type:k.type,storage_path:d,status:"uploaded"}).select().single();if(g)throw g;let h=["1080p","720p","480p","360p"].map(a=>({video_id:f.id,resolution:a,status:"pending",progress:0})),{error:i}=await b.from("conversion_jobs").insert(h);if(i)throw i;l(null),n(""),s.current&&(s.current.value=""),window.location.reload()}catch(a){r(a.message||"Failed to upload video")}finally{p(!1)}};return(0,b.jsxs)("div",{className:"glass-strong rounded-2xl p-8",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center gap-3",children:[(0,b.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/20",children:(0,b.jsx)(g,{className:"h-6 w-6 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Upload Video"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Convert to multiple resolutions automatically"})]})]}),q&&(0,b.jsx)("div",{className:"mb-4 rounded-lg bg-destructive/10 p-3 text-sm text-destructive border border-destructive/20",children:q}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"title",children:"Video Title"}),(0,b.jsx)(e.Input,{id:"title",placeholder:"Enter a title for your video",value:m,onChange:a=>n(a.target.value),disabled:o})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"file",children:"Video File"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.Input,{id:"file",ref:s,type:"file",accept:"video/*",onChange:a=>{let b=a.target.files?.[0];if(b){if(!b.type.startsWith("video/"))return void r("Please select a valid video file");l(b),r(null),m||n(b.name.replace(/\.[^/.]+$/,""))}},disabled:o,className:"flex-1"}),k&&(0,b.jsxs)("div",{className:"flex items-center gap-2 rounded-lg bg-muted px-3 py-2",children:[(0,b.jsx)(h.Video,{className:"h-4 w-4 text-primary"}),(0,b.jsx)("span",{className:"text-sm",children:k.name})]})]})]}),(0,b.jsx)(d.Button,{onClick:t,disabled:o||!k||!m,className:"w-full",size:"lg",children:o?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"Uploading..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g,{className:"mr-2 h-5 w-5"}),"Upload and Convert"]})})]})]})}a.s(["VideoUpload",()=>k],42093)},33441,a=>{"use strict";let b=(0,a.i(70106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],33441)},56399,a=>{"use strict";var b=a.i(87924),c=a.i(41479),d=a.i(64791),e=a.i(70106);let f=(0,e.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var g=a.i(33441);let h=(0,e.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var i=a.i(96221);let j=(0,e.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),k=(0,e.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var l=a.i(72131),m=a.i(30553),n="Progress",[o,p]=function(a,c=[]){let d=[],e=()=>{let b=d.map(a=>l.createContext(a));return function(c){let d=c?.[a]||b;return l.useMemo(()=>({[`__scope${a}`]:{...c,[a]:d}}),[c,d])}};return e.scopeName=a,[function(c,e){let f=l.createContext(e),g=d.length;d=[...d,e];let h=c=>{let{scope:d,children:e,...h}=c,i=d?.[a]?.[g]||f,j=l.useMemo(()=>h,Object.values(h));return(0,b.jsx)(i.Provider,{value:j,children:e})};return h.displayName=c+"Provider",[h,function(b,d){let h=d?.[a]?.[g]||f,i=l.useContext(h);if(i)return i;if(void 0!==e)return e;throw Error(`\`${b}\` must be used within \`${c}\``)}]},function(...a){let b=a[0];if(1===a.length)return b;let c=()=>{let c=a.map(a=>({useScope:a(),scopeName:a.scopeName}));return function(a){let d=c.reduce((b,{useScope:c,scopeName:d})=>{let e=c(a)[`__scope${d}`];return{...b,...e}},{});return l.useMemo(()=>({[`__scope${b.scopeName}`]:d}),[d])}};return c.scopeName=b.scopeName,c}(e,...c)]}(n),[q,r]=o(n),s=l.forwardRef((a,c)=>{var d,e;let{__scopeProgress:f,value:g=null,max:h,getValueLabel:i=v,...j}=a;(h||0===h)&&!y(h)&&console.error((d=`${h}`,`Invalid prop \`max\` of value \`${d}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let k=y(h)?h:100;null===g||z(g,k)||console.error((e=`${g}`,`Invalid prop \`value\` of value \`${e}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let l=z(g,k)?g:null,n=x(l)?i(l,k):void 0;return(0,b.jsx)(q,{scope:f,value:l,max:k,children:(0,b.jsx)(m.Primitive.div,{"aria-valuemax":k,"aria-valuemin":0,"aria-valuenow":x(l)?l:void 0,"aria-valuetext":n,role:"progressbar","data-state":w(l,k),"data-value":l??void 0,"data-max":k,...j,ref:c})})});s.displayName=n;var t="ProgressIndicator",u=l.forwardRef((a,c)=>{let{__scopeProgress:d,...e}=a,f=r(t,d);return(0,b.jsx)(m.Primitive.div,{"data-state":w(f.value,f.max),"data-value":f.value??void 0,"data-max":f.max,...e,ref:c})});function v(a,b){return`${Math.round(a/b*100)}%`}function w(a,b){return null==a?"indeterminate":a===b?"complete":"loading"}function x(a){return"number"==typeof a}function y(a){return x(a)&&!isNaN(a)&&a>0}function z(a,b){return x(a)&&!isNaN(a)&&a<=b&&a>=0}u.displayName=t;var A=a.i(97895);function B({className:a,value:c,...d}){return(0,b.jsx)(s,{"data-slot":"progress",className:(0,A.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",a),...d,children:(0,b.jsx)(u,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(c||0)}%)`}})})}var C=a.i(40695),D=a.i(31815),E=a.i(1182),F=a.i(69240);function G({video:a}){var c;let[e,m]=(0,l.useState)(!1),[n,o]=(0,l.useState)(null),{convertVideo:p,converting:q}=function(){let{ffmpeg:a,isLoaded:b}=(0,D.useFFmpeg)(),[c,d]=(0,l.useState)(!1);return{convertVideo:async(c,e,f)=>{if(!b)throw Error("Video converter not ready");d(!0);let g=(0,F.createClient)();try{await g.from("videos").update({status:"processing"}).eq("id",c);let{data:b,error:d}=await g.storage.from("videos").download(e);if(d)throw d;let h=null!==a;for(let c of f)try{let d;if(await g.from("conversion_jobs").update({status:"processing",started_at:new Date().toISOString(),progress:0}).eq("id",c.id),h&&a){let e="input.mp4";await a.writeFile(e,await (0,E.fetchFile)(b));let f=`output_${c.resolution}.mp4`,h=Number.parseInt(c.resolution.replace("p",""));a.on("progress",({progress:a})=>{let b=Math.round(100*a);g.from("conversion_jobs").update({progress:b}).eq("id",c.id)}),await a.exec(["-i",e,"-vf",`scale=-2:${h}`,"-c:v","libx264","-preset","fast","-crf","23","-c:a","aac","-b:a","128k",f]);let i=await a.readFile(f);d=new Blob([i],{type:"video/mp4"}),await a.deleteFile(e),await a.deleteFile(f)}else{for(let a=1;a<=10;a++){let b=Math.round(a/10*100);await g.from("conversion_jobs").update({progress:b}).eq("id",c.id);let d=Number.parseInt(c.resolution.replace("p","")),e=300+d/1080*200;await new Promise(a=>setTimeout(a,e))}d=b}let f=`${e.split("/")[0]}/converted_${c.resolution}_${Date.now()}.mp4`,{error:i}=await g.storage.from("videos").upload(f,d);if(i)throw i;let{data:j}=g.storage.from("videos").getPublicUrl(f);await g.from("conversion_jobs").update({status:"completed",progress:100,completed_at:new Date().toISOString(),output_path:f,output_url:j.publicUrl,file_size:d.size}).eq("id",c.id)}catch(a){console.error(`Error converting ${c.resolution}:`,a),await g.from("conversion_jobs").update({status:"failed",error_message:a.message}).eq("id",c.id)}let{data:i}=await g.from("conversion_jobs").select("status").eq("video_id",c),j=i?.every(a=>"completed"===a.status),k=i?.some(a=>"failed"===a.status);await g.from("videos").update({status:j?"completed":k?"failed":"processing"}).eq("id",c)}catch(a){throw console.error("Conversion error:",a),await g.from("videos").update({status:"failed"}).eq("id",c),a}finally{d(!1)}},converting:c,isReady:b}}(),{isLoaded:r,isLoading:s}=(0,D.useFFmpeg)(),t=a.conversion_jobs?.filter(a=>"completed"===a.status).length||0,u=a.conversion_jobs?.filter(a=>"processing"===a.status).length||0,v=a.conversion_jobs?.length||0,w=v>0?t/v*100:0,x=a.conversion_jobs?.some(a=>"pending"!==a.status),y=async b=>{if(b.output_url)try{let c=await fetch(b.output_url);if(!c.ok)throw Error(`Failed to download: ${c.statusText}`);let d=await c.blob(),e=window.URL.createObjectURL(d),f=document.createElement("a");f.href=e,f.download=`${a.title}-${b.resolution}.mp4`,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(e)}catch(a){console.error("Error downloading file:",a),alert(`Failed to download video: ${a instanceof Error?a.message:"Unknown error"}`)}},z=async()=>{if(!r)return void o("Video converter is still loading. Please wait...");m(!0),o(null);try{let b=a.conversion_jobs.filter(a=>"pending"===a.status);if(0===b.length)return void o("No pending conversions found");await p(a.id,a.storage_path,b)}catch(a){console.error("Error starting conversion:",a),o(a instanceof Error?a.message:"Failed to start conversion")}finally{m(!1)}};return(0,b.jsxs)("div",{className:"glass rounded-xl overflow-hidden transition-all hover:shadow-lg hover:shadow-primary/10",children:[(0,b.jsxs)("div",{className:"aspect-video bg-muted/50 flex items-center justify-center relative overflow-hidden",children:[(0,b.jsx)(d.Video,{className:"h-12 w-12 text-muted-foreground opacity-50"}),u>0&&(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(i.Loader2,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-2"}),(0,b.jsxs)("p",{className:"text-sm font-medium",children:["Processing ",u," ",1===u?"file":"files","..."]})]})}),t===v&&v>0&&(0,b.jsxs)("div",{className:"absolute top-4 right-4 bg-green-500/90 backdrop-blur-sm px-3 py-1 rounded-full flex items-center gap-1.5",children:[(0,b.jsx)(g.Check,{className:"h-3 w-3"}),(0,b.jsx)("span",{className:"text-xs font-medium",children:"Complete"})]})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-1 text-balance line-clamp-1",children:a.title}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,b.jsx)("span",{children:(c=a.file_size)<1024?c+" B":c<1048576?(c/1024).toFixed(1)+" KB":c<0x40000000?(c/1048576).toFixed(1)+" MB":(c/0x40000000).toFixed(1)+" GB"}),(0,b.jsx)("span",{children:new Date(a.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),s&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,b.jsx)(i.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsx)("span",{children:"Loading video converter..."})]}),!x&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Button,{onClick:z,disabled:e||q||s||!r,className:"w-full",size:"sm",children:e||q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),e?"Starting...":"Converting..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j,{className:"mr-2 h-4 w-4"}),"Start Conversion"]})}),n&&(0,b.jsx)("p",{className:"text-xs text-destructive text-center",children:n})]}),x&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:["Overall Progress: ",t,"/",v]}),(0,b.jsxs)("span",{className:"font-semibold text-primary",children:[Math.round(w),"%"]})]}),(0,b.jsx)(B,{value:w,className:"h-2.5"})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Resolutions"}),a.conversion_jobs?.map(a=>(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(a=>{switch(a){case"completed":return(0,b.jsx)(g.Check,{className:"h-4 w-4 text-green-500"});case"processing":return(0,b.jsx)(i.Loader2,{className:"h-4 w-4 animate-spin text-primary"});case"failed":return(0,b.jsx)(h,{className:"h-4 w-4 text-destructive"});default:return(0,b.jsx)(f,{className:"h-4 w-4 text-muted-foreground"})}})(a.status),(0,b.jsx)("span",{className:"text-sm font-medium",children:a.resolution})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["processing"===a.status&&(0,b.jsxs)("span",{className:"text-sm text-primary font-semibold",children:[a.progress,"%"]}),"completed"===a.status&&(0,b.jsx)(C.Button,{size:"sm",variant:"ghost",className:"h-7 px-2",onClick:()=>y(a),title:`Download ${a.resolution} version`,children:(0,b.jsx)(k,{className:"h-3.5 w-3.5"})}),"pending"===a.status&&(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Queued"})]})]}),("processing"===a.status||"completed"===a.status)&&(0,b.jsx)(B,{value:a.progress||0,className:"h-1.5"})]},a.id))]})]})]})}function H({className:a,...c}){return(0,b.jsx)("div",{"data-slot":"skeleton",className:(0,A.cn)("bg-accent animate-pulse rounded-md",a),...c})}function I({userId:a}){let{videos:d,loading:e}=function(a){let[b,c]=(0,l.useState)([]),[d,e]=(0,l.useState)(!0),f=(0,F.createClient)();return(0,l.useEffect)(()=>{let b;return(async()=>{let{data:d,error:g}=await f.from("videos").select(`
          *,
          conversion_jobs (*)
        `).eq("user_id",a).order("created_at",{ascending:!1});!g&&d&&c(d),e(!1),b=f.channel("video_changes").on("postgres_changes",{event:"*",schema:"public",table:"videos",filter:`user_id=eq.${a}`},a=>{var b;console.log("[v0] Video change:",a),"INSERT"===(b=a).eventType?f.from("videos").select(`
            *,
            conversion_jobs (*)
          `).eq("id",b.new.id).single().then(({data:a})=>{a&&c(b=>[a,...b])}):"UPDATE"===b.eventType?c(a=>a.map(a=>a.id===b.new.id?{...a,...b.new}:a)):"DELETE"===b.eventType&&c(a=>a.filter(a=>a.id!==b.old.id))}).on("postgres_changes",{event:"*",schema:"public",table:"conversion_jobs"},a=>{var b;console.log("[v0] Conversion job change:",a),b=a,c(a=>a.map(a=>{if(a.id===b.new?.video_id||a.id===b.old?.video_id){if(b.new?.video_id||b.old?.video_id,"UPDATE"===b.eventType)return{...a,conversion_jobs:a.conversion_jobs?.map(a=>a.id===b.new.id?{...a,...b.new}:a)};if("INSERT"===b.eventType)return{...a,conversion_jobs:[...a.conversion_jobs||[],b.new]};if("DELETE"===b.eventType)return{...a,conversion_jobs:a.conversion_jobs?.filter(a=>a.id!==b.old.id)}}return a}))}).subscribe()})(),()=>{b&&f.removeChannel(b)}},[a]),{videos:b,loading:d}}(a);return e?(0,b.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(a=>(0,b.jsxs)("div",{className:"glass rounded-xl overflow-hidden",children:[(0,b.jsx)(H,{className:"aspect-video w-full"}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsx)(H,{className:"h-6 w-3/4"}),(0,b.jsx)(H,{className:"h-4 w-1/2"}),(0,b.jsx)(H,{className:"h-2 w-full"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(H,{className:"h-10 w-full"}),(0,b.jsx)(H,{className:"h-10 w-full"})]})]})]},a))}):d&&0!==d.length?(0,b.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:d.map(a=>(0,b.jsx)(G,{video:a},a.id))}):(0,b.jsxs)("div",{className:"glass rounded-2xl p-12 text-center",children:[(0,b.jsx)(c.VideoIcon,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground opacity-50"}),(0,b.jsx)("h3",{className:"mb-2 text-xl font-semibold",children:"No videos yet"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Upload your first video to get started"})]})}a.s(["VideoListRealtime",()=>I],56399)},98062,a=>{"use strict";var b=a.i(87924),c=a.i(31815),d=a.i(33441);function e(){let{isLoaded:a}=(0,c.useFFmpeg)();return a?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-500 bg-green-500/10 px-3 py-2 rounded-lg border border-green-500/20",children:[(0,b.jsx)(d.Check,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"Video converter ready"})]}):null}a.s(["FFmpegStatus",()=>e])}];

//# sourceMappingURL=_a4789277._.js.map