(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},98183,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={assign:function(){return l},searchParamsToUrlQuery:function(){return a},urlQueryToSearchParams:function(){return i}};for(var n in s)Object.defineProperty(r,n,{enumerable:!0,get:s[n]});function a(e){let t={};for(let[r,s]of e.entries()){let e=t[r];void 0===e?t[r]=s:Array.isArray(e)?e.push(s):t[r]=[e,s]}return t}function o(e){return"string"==typeof e?e:("number"!=typeof e||isNaN(e))&&"boolean"!=typeof e?"":String(e)}function i(e){let t=new URLSearchParams;for(let[r,s]of Object.entries(e))if(Array.isArray(s))for(let e of s)t.append(r,o(e));else t.set(r,o(s));return t}function l(e,...t){for(let r of t){for(let t of r.keys())e.delete(t);for(let[t,s]of r.entries())e.append(t,s)}return e}},95057,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={formatUrl:function(){return i},formatWithValidation:function(){return c},urlObjectKeys:function(){return l}};for(var n in s)Object.defineProperty(r,n,{enumerable:!0,get:s[n]});let a=e.r(90809)._(e.r(98183)),o=/https?|ftp|gopher|file/;function i(e){let{auth:t,hostname:r}=e,s=e.protocol||"",n=e.pathname||"",i=e.hash||"",l=e.query||"",c=!1;t=t?encodeURIComponent(t).replace(/%3A/i,":")+"@":"",e.host?c=t+e.host:r&&(c=t+(~r.indexOf(":")?`[${r}]`:r),e.port&&(c+=":"+e.port)),l&&"object"==typeof l&&(l=String(a.urlQueryToSearchParams(l)));let u=e.search||l&&`?${l}`||"";return s&&!s.endsWith(":")&&(s+=":"),e.slashes||(!s||o.test(s))&&!1!==c?(c="//"+(c||""),n&&"/"!==n[0]&&(n="/"+n)):c||(c=""),i&&"#"!==i[0]&&(i="#"+i),u&&"?"!==u[0]&&(u="?"+u),n=n.replace(/[?#]/g,encodeURIComponent),u=u.replace("#","%23"),`${s}${c}${n}${u}${i}`}let l=["auth","hash","host","hostname","href","path","pathname","port","protocol","query","search","slashes"];function c(e){return i(e)}},18581,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"useMergedRef",{enumerable:!0,get:function(){return n}});let s=e.r(71645);function n(e,t){let r=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,s.useCallback)(s=>{if(null===s){let e=r.current;e&&(r.current=null,e());let t=n.current;t&&(n.current=null,t())}else e&&(r.current=a(e,s)),t&&(n.current=a(t,s))},[e,t])}function a(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let r=e(t);return"function"==typeof r?r:()=>e(null)}}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},18967,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={DecodeError:function(){return x},MiddlewareNotFoundError:function(){return b},MissingStaticPage:function(){return j},NormalizeError:function(){return g},PageNotFoundError:function(){return y},SP:function(){return h},ST:function(){return v},WEB_VITALS:function(){return a},execOnce:function(){return o},getDisplayName:function(){return d},getLocationOrigin:function(){return c},getURL:function(){return u},isAbsoluteUrl:function(){return l},isResSent:function(){return f},loadGetInitialProps:function(){return m},normalizeRepeatedSlashes:function(){return p},stringifyError:function(){return w}};for(var n in s)Object.defineProperty(r,n,{enumerable:!0,get:s[n]});let a=["CLS","FCP","FID","INP","LCP","TTFB"];function o(e){let t,r=!1;return(...s)=>(r||(r=!0,t=e(...s)),t)}let i=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,l=e=>i.test(e);function c(){let{protocol:e,hostname:t,port:r}=window.location;return`${e}//${t}${r?":"+r:""}`}function u(){let{href:e}=window.location,t=c();return e.substring(t.length)}function d(e){return"string"==typeof e?e:e.displayName||e.name||"Unknown"}function f(e){return e.finished||e.headersSent}function p(e){let t=e.split("?");return t[0].replace(/\\/g,"/").replace(/\/\/+/g,"/")+(t[1]?`?${t.slice(1).join("?")}`:"")}async function m(e,t){let r=t.res||t.ctx&&t.ctx.res;if(!e.getInitialProps)return t.ctx&&t.Component?{pageProps:await m(t.Component,t.ctx)}:{};let s=await e.getInitialProps(t);if(r&&f(r))return s;if(!s)throw Object.defineProperty(Error(`"${d(e)}.getInitialProps()" should resolve to an object. But found "${s}" instead.`),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return s}let h="undefined"!=typeof performance,v=h&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class x extends Error{}class g extends Error{}class y extends Error{constructor(e){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message=`Cannot find module for page: ${e}`}}class j extends Error{constructor(e,t){super(),this.message=`Failed to load static file for page: ${e} ${t}`}}class b extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}}function w(e){return JSON.stringify({message:e.message,stack:e.stack})}},73668,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"isLocalURL",{enumerable:!0,get:function(){return a}});let s=e.r(18967),n=e.r(52817);function a(e){if(!(0,s.isAbsoluteUrl)(e))return!0;try{let t=(0,s.getLocationOrigin)(),r=new URL(e,t);return r.origin===t&&(0,n.hasBasePath)(r.pathname)}catch(e){return!1}}},84508,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"errorOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},22016,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s={default:function(){return x},useLinkStatus:function(){return y}};for(var n in s)Object.defineProperty(r,n,{enumerable:!0,get:s[n]});let a=e.r(90809),o=e.r(43476),i=a._(e.r(71645)),l=e.r(95057),c=e.r(8372),u=e.r(18581),d=e.r(18967),f=e.r(5550);e.r(33525);let p=e.r(91949),m=e.r(73668),h=e.r(9396);function v(e){return"string"==typeof e?e:(0,l.formatUrl)(e)}function x(t){var r;let s,n,a,[l,x]=(0,i.useOptimistic)(p.IDLE_LINK_STATUS),y=(0,i.useRef)(null),{href:j,as:b,children:w,prefetch:N=null,passHref:_,replace:P,shallow:C,scroll:E,onClick:k,onMouseEnter:S,onTouchStart:O,legacyBehavior:T=!1,onNavigate:$,ref:L,unstable_dynamicOnHover:F,...R}=t;s=w,T&&("string"==typeof s||"number"==typeof s)&&(s=(0,o.jsx)("a",{children:s}));let U=i.default.useContext(c.AppRouterContext),M=!1!==N,I=!1!==N?null===(r=N)||"auto"===r?h.FetchStrategy.PPR:h.FetchStrategy.Full:h.FetchStrategy.PPR,{href:D,as:A}=i.default.useMemo(()=>{let e=v(j);return{href:e,as:b?v(b):e}},[j,b]);if(T){if(s?.$$typeof===Symbol.for("react.lazy"))throw Object.defineProperty(Error("`<Link legacyBehavior>` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's `<a>` tag."),"__NEXT_ERROR_CODE",{value:"E863",enumerable:!1,configurable:!0});n=i.default.Children.only(s)}let V=T?n&&"object"==typeof n&&n.ref:L,B=i.default.useCallback(e=>(null!==U&&(y.current=(0,p.mountLinkInstance)(e,D,U,I,M,x)),()=>{y.current&&((0,p.unmountLinkForCurrentNavigation)(y.current),y.current=null),(0,p.unmountPrefetchableInstance)(e)}),[M,D,U,I,x]),q={ref:(0,u.useMergedRef)(B,V),onClick(t){T||"function"!=typeof k||k(t),T&&n.props&&"function"==typeof n.props.onClick&&n.props.onClick(t),!U||t.defaultPrevented||function(t,r,s,n,a,o,l){if("undefined"!=typeof window){let c,{nodeName:u}=t.currentTarget;if("A"===u.toUpperCase()&&((c=t.currentTarget.getAttribute("target"))&&"_self"!==c||t.metaKey||t.ctrlKey||t.shiftKey||t.altKey||t.nativeEvent&&2===t.nativeEvent.which)||t.currentTarget.hasAttribute("download"))return;if(!(0,m.isLocalURL)(r)){a&&(t.preventDefault(),location.replace(r));return}if(t.preventDefault(),l){let e=!1;if(l({preventDefault:()=>{e=!0}}),e)return}let{dispatchNavigateAction:d}=e.r(99781);i.default.startTransition(()=>{d(s||r,a?"replace":"push",o??!0,n.current)})}}(t,D,A,y,P,E,$)},onMouseEnter(e){T||"function"!=typeof S||S(e),T&&n.props&&"function"==typeof n.props.onMouseEnter&&n.props.onMouseEnter(e),U&&M&&(0,p.onNavigationIntent)(e.currentTarget,!0===F)},onTouchStart:function(e){T||"function"!=typeof O||O(e),T&&n.props&&"function"==typeof n.props.onTouchStart&&n.props.onTouchStart(e),U&&M&&(0,p.onNavigationIntent)(e.currentTarget,!0===F)}};return(0,d.isAbsoluteUrl)(A)?q.href=A:T&&!_&&("a"!==n.type||"href"in n.props)||(q.href=(0,f.addBasePath)(A)),a=T?i.default.cloneElement(n,q):(0,o.jsx)("a",{...R,...q,children:s}),(0,o.jsx)(g.Provider,{value:l,children:a})}e.r(84508);let g=(0,i.createContext)(p.IDLE_LINK_STATUS),y=()=>(0,i.useContext)(g);("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},18975,e=>{"use strict";let t=(0,e.i(75254).default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);e.s(["default",()=>t])},7972,e=>{"use strict";var t=e.i(18975);e.s(["VideoIcon",()=>t.default])},64547,e=>{"use strict";var t=e.i(43476),r=e.i(22016),s=e.i(7972);let n=(0,e.i(75254).default)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);var a=e.i(67881),o=e.i(20755),i=e.i(18566);function l({user:e}){let l=(0,i.useRouter)(),c=async()=>{let e=(0,o.createClient)();await e.auth.signOut(),l.push("/"),l.refresh()};return(0,t.jsx)("header",{className:"border-b border-border/50 bg-background/50 backdrop-blur-sm",children:(0,t.jsx)("div",{className:"container mx-auto px-4 py-4",children:(0,t.jsxs)("nav",{className:"flex items-center justify-between",children:[(0,t.jsxs)(r.default,{href:"/dashboard",className:"flex items-center gap-2",children:[(0,t.jsx)(s.VideoIcon,{className:"h-8 w-8 text-primary"}),(0,t.jsx)("span",{className:"text-2xl font-bold",children:"ScaleStream"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:e.email}),(0,t.jsxs)(a.Button,{variant:"ghost",size:"sm",onClick:c,children:[(0,t.jsx)(n,{className:"mr-2 h-4 w-4"}),"Log out"]})]})]})})})}e.s(["DashboardHeader",()=>l],64547)},78716,e=>{"use strict";var t=e.i(18975);e.s(["Video",()=>t.default])},37765,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(67881),n=e.i(23750),a=e.i(10708);let o=(0,e.i(75254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var i=e.i(78716),l=e.i(31278),c=e.i(20755);function u({userId:e}){let[u,d]=(0,r.useState)(null),[f,p]=(0,r.useState)(""),[m,h]=(0,r.useState)(!1),[v,x]=(0,r.useState)(null),g=(0,r.useRef)(null),y=async()=>{if(!u||!f)return void x("Please select a file and enter a title");h(!0),x(null);try{let t=(0,c.createClient)(),r=u.name.split(".").pop(),s=`${e}/${Date.now()}.${r}`,{error:n}=await t.storage.from("videos").upload(s,u,{cacheControl:"3600",upsert:!1});if(n)throw n;let{data:a,error:o}=await t.from("videos").insert({user_id:e,title:f,original_filename:u.name,file_size:u.size,mime_type:u.type,storage_path:s,status:"uploaded"}).select().single();if(o)throw o;let i=["1080p","720p","480p","360p"].map(e=>({video_id:a.id,resolution:e,status:"pending",progress:0})),{error:l}=await t.from("conversion_jobs").insert(i);if(l)throw l;d(null),p(""),g.current&&(g.current.value=""),window.location.reload()}catch(e){x(e.message||"Failed to upload video")}finally{h(!1)}};return(0,t.jsxs)("div",{className:"glass-strong rounded-2xl p-8",children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center gap-3",children:[(0,t.jsx)("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-primary/20",children:(0,t.jsx)(o,{className:"h-6 w-6 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Upload Video"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Convert to multiple resolutions automatically"})]})]}),v&&(0,t.jsx)("div",{className:"mb-4 rounded-lg bg-destructive/10 p-3 text-sm text-destructive border border-destructive/20",children:v}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(a.Label,{htmlFor:"title",children:"Video Title"}),(0,t.jsx)(n.Input,{id:"title",placeholder:"Enter a title for your video",value:f,onChange:e=>p(e.target.value),disabled:m})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(a.Label,{htmlFor:"file",children:"Video File"}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(n.Input,{id:"file",ref:g,type:"file",accept:"video/*",onChange:e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith("video/"))return void x("Please select a valid video file");d(t),x(null),f||p(t.name.replace(/\.[^/.]+$/,""))}},disabled:m,className:"flex-1"}),u&&(0,t.jsxs)("div",{className:"flex items-center gap-2 rounded-lg bg-muted px-3 py-2",children:[(0,t.jsx)(i.Video,{className:"h-4 w-4 text-primary"}),(0,t.jsx)("span",{className:"text-sm",children:u.name})]})]})]}),(0,t.jsx)(s.Button,{onClick:y,disabled:m||!u||!f,className:"w-full",size:"lg",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Loader2,{className:"mr-2 h-5 w-5 animate-spin"}),"Uploading..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o,{className:"mr-2 h-5 w-5"}),"Upload and Convert"]})})]})]})}e.s(["VideoUpload",()=>u],37765)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},69020,e=>{"use strict";var t=e.i(43476),r=e.i(7972),s=e.i(78716),n=e.i(75254);let a=(0,n.default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);var o=e.i(43531);let i=(0,n.default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var l=e.i(31278);let c=(0,n.default)("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),u=(0,n.default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);var d=e.i(71645),f=e.i(48425),p="Progress",[m,h]=function(e,r=[]){let s=[],n=()=>{let t=s.map(e=>d.createContext(e));return function(r){let s=r?.[e]||t;return d.useMemo(()=>({[`__scope${e}`]:{...r,[e]:s}}),[r,s])}};return n.scopeName=e,[function(r,n){let a=d.createContext(n),o=s.length;s=[...s,n];let i=r=>{let{scope:s,children:n,...i}=r,l=s?.[e]?.[o]||a,c=d.useMemo(()=>i,Object.values(i));return(0,t.jsx)(l.Provider,{value:c,children:n})};return i.displayName=r+"Provider",[i,function(t,s){let i=s?.[e]?.[o]||a,l=d.useContext(i);if(l)return l;if(void 0!==n)return n;throw Error(`\`${t}\` must be used within \`${r}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let s=r.reduce((t,{useScope:r,scopeName:s})=>{let n=r(e)[`__scope${s}`];return{...t,...n}},{});return d.useMemo(()=>({[`__scope${t.scopeName}`]:s}),[s])}};return r.scopeName=t.scopeName,r}(n,...r)]}(p),[v,x]=m(p),g=d.forwardRef((e,r)=>{var s,n;let{__scopeProgress:a,value:o=null,max:i,getValueLabel:l=b,...c}=e;(i||0===i)&&!_(i)&&console.error((s=`${i}`,`Invalid prop \`max\` of value \`${s}\` supplied to \`Progress\`. Only numbers greater than 0 are valid max values. Defaulting to \`100\`.`));let u=_(i)?i:100;null===o||P(o,u)||console.error((n=`${o}`,`Invalid prop \`value\` of value \`${n}\` supplied to \`Progress\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or 100 if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`));let d=P(o,u)?o:null,p=N(d)?l(d,u):void 0;return(0,t.jsx)(v,{scope:a,value:d,max:u,children:(0,t.jsx)(f.Primitive.div,{"aria-valuemax":u,"aria-valuemin":0,"aria-valuenow":N(d)?d:void 0,"aria-valuetext":p,role:"progressbar","data-state":w(d,u),"data-value":d??void 0,"data-max":u,...c,ref:r})})});g.displayName=p;var y="ProgressIndicator",j=d.forwardRef((e,r)=>{let{__scopeProgress:s,...n}=e,a=x(y,s);return(0,t.jsx)(f.Primitive.div,{"data-state":w(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...n,ref:r})});function b(e,t){return`${Math.round(e/t*100)}%`}function w(e,t){return null==e?"indeterminate":e===t?"complete":"loading"}function N(e){return"number"==typeof e}function _(e){return N(e)&&!isNaN(e)&&e>0}function P(e,t){return N(e)&&!isNaN(e)&&e<=t&&e>=0}j.displayName=y;var C=e.i(47163);function E({className:e,value:r,...s}){return(0,t.jsx)(g,{"data-slot":"progress",className:(0,C.cn)("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...s,children:(0,t.jsx)(j,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})})}var k=e.i(67881),S=e.i(27484),O=e.i(41885),T=e.i(20755);function $({video:e}){var r;let[n,f]=(0,d.useState)(!1),[p,m]=(0,d.useState)(null),{convertVideo:h,converting:v}=function(){let{ffmpeg:e,isLoaded:t}=(0,S.useFFmpeg)(),[r,s]=(0,d.useState)(!1);return{convertVideo:async(r,n,a)=>{if(!t)throw Error("Video converter not ready");s(!0);let o=(0,T.createClient)();try{await o.from("videos").update({status:"processing"}).eq("id",r);let{data:t,error:s}=await o.storage.from("videos").download(n);if(s)throw s;let i=null!==e;for(let r of a)try{let s;if(await o.from("conversion_jobs").update({status:"processing",started_at:new Date().toISOString(),progress:0}).eq("id",r.id),i&&e){let n="input.mp4";await e.writeFile(n,await (0,O.fetchFile)(t));let a=`output_${r.resolution}.mp4`,i=Number.parseInt(r.resolution.replace("p",""));e.on("progress",({progress:e})=>{let t=Math.round(100*e);o.from("conversion_jobs").update({progress:t}).eq("id",r.id)}),await e.exec(["-i",n,"-vf",`scale=-2:${i}`,"-c:v","libx264","-preset","fast","-crf","23","-c:a","aac","-b:a","128k",a]);let l=await e.readFile(a);s=new Blob([l],{type:"video/mp4"}),await e.deleteFile(n),await e.deleteFile(a)}else{for(let e=1;e<=10;e++){let t=Math.round(e/10*100);await o.from("conversion_jobs").update({progress:t}).eq("id",r.id);let s=Number.parseInt(r.resolution.replace("p","")),n=300+s/1080*200;await new Promise(e=>setTimeout(e,n))}s=t}let a=`${n.split("/")[0]}/converted_${r.resolution}_${Date.now()}.mp4`,{error:l}=await o.storage.from("videos").upload(a,s);if(l)throw l;let{data:c}=o.storage.from("videos").getPublicUrl(a);await o.from("conversion_jobs").update({status:"completed",progress:100,completed_at:new Date().toISOString(),output_path:a,output_url:c.publicUrl,file_size:s.size}).eq("id",r.id)}catch(e){console.error(`Error converting ${r.resolution}:`,e),await o.from("conversion_jobs").update({status:"failed",error_message:e.message}).eq("id",r.id)}let{data:l}=await o.from("conversion_jobs").select("status").eq("video_id",r),c=l?.every(e=>"completed"===e.status),u=l?.some(e=>"failed"===e.status);await o.from("videos").update({status:c?"completed":u?"failed":"processing"}).eq("id",r)}catch(e){throw console.error("Conversion error:",e),await o.from("videos").update({status:"failed"}).eq("id",r),e}finally{s(!1)}},converting:r,isReady:t}}(),{isLoaded:x,isLoading:g}=(0,S.useFFmpeg)(),y=e.conversion_jobs?.filter(e=>"completed"===e.status).length||0,j=e.conversion_jobs?.filter(e=>"processing"===e.status).length||0,b=e.conversion_jobs?.length||0,w=b>0?y/b*100:0,N=e.conversion_jobs?.some(e=>"pending"!==e.status),_=async t=>{if(t.output_url)try{let r=await fetch(t.output_url);if(!r.ok)throw Error(`Failed to download: ${r.statusText}`);let s=await r.blob(),n=window.URL.createObjectURL(s),a=document.createElement("a");a.href=n,a.download=`${e.title}-${t.resolution}.mp4`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(n)}catch(e){console.error("Error downloading file:",e),alert(`Failed to download video: ${e instanceof Error?e.message:"Unknown error"}`)}},P=async()=>{if(!x)return void m("Video converter is still loading. Please wait...");f(!0),m(null);try{let t=e.conversion_jobs.filter(e=>"pending"===e.status);if(0===t.length)return void m("No pending conversions found");await h(e.id,e.storage_path,t)}catch(e){console.error("Error starting conversion:",e),m(e instanceof Error?e.message:"Failed to start conversion")}finally{f(!1)}};return(0,t.jsxs)("div",{className:"glass rounded-xl overflow-hidden transition-all hover:shadow-lg hover:shadow-primary/10",children:[(0,t.jsxs)("div",{className:"aspect-video bg-muted/50 flex items-center justify-center relative overflow-hidden",children:[(0,t.jsx)(s.Video,{className:"h-12 w-12 text-muted-foreground opacity-50"}),j>0&&(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-primary mx-auto mb-2"}),(0,t.jsxs)("p",{className:"text-sm font-medium",children:["Processing ",j," ",1===j?"file":"files","..."]})]})}),y===b&&b>0&&(0,t.jsxs)("div",{className:"absolute top-4 right-4 bg-green-500/90 backdrop-blur-sm px-3 py-1 rounded-full flex items-center gap-1.5",children:[(0,t.jsx)(o.Check,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs font-medium",children:"Complete"})]})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-lg mb-1 text-balance line-clamp-1",children:e.title}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,t.jsx)("span",{children:(r=e.file_size)<1024?r+" B":r<1048576?(r/1024).toFixed(1)+" KB":r<0x40000000?(r/1048576).toFixed(1)+" MB":(r/0x40000000).toFixed(1)+" GB"}),(0,t.jsx)("span",{children:new Date(e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),g&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{children:"Loading video converter..."})]}),!N&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(k.Button,{onClick:P,disabled:n||v||g||!x,className:"w-full",size:"sm",children:n||v?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),n?"Starting...":"Converting..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c,{className:"mr-2 h-4 w-4"}),"Start Conversion"]})}),p&&(0,t.jsx)("p",{className:"text-xs text-destructive text-center",children:p})]}),N&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("span",{className:"text-muted-foreground",children:["Overall Progress: ",y,"/",b]}),(0,t.jsxs)("span",{className:"font-semibold text-primary",children:[Math.round(w),"%"]})]}),(0,t.jsx)(E,{value:w,className:"h-2.5"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Resolutions"}),e.conversion_jobs?.map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"completed":return(0,t.jsx)(o.Check,{className:"h-4 w-4 text-green-500"});case"processing":return(0,t.jsx)(l.Loader2,{className:"h-4 w-4 animate-spin text-primary"});case"failed":return(0,t.jsx)(i,{className:"h-4 w-4 text-destructive"});default:return(0,t.jsx)(a,{className:"h-4 w-4 text-muted-foreground"})}})(e.status),(0,t.jsx)("span",{className:"text-sm font-medium",children:e.resolution})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["processing"===e.status&&(0,t.jsxs)("span",{className:"text-sm text-primary font-semibold",children:[e.progress,"%"]}),"completed"===e.status&&(0,t.jsx)(k.Button,{size:"sm",variant:"ghost",className:"h-7 px-2",onClick:()=>_(e),title:`Download ${e.resolution} version`,children:(0,t.jsx)(u,{className:"h-3.5 w-3.5"})}),"pending"===e.status&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:"Queued"})]})]}),("processing"===e.status||"completed"===e.status)&&(0,t.jsx)(E,{value:e.progress||0,className:"h-1.5"})]},e.id))]})]})]})}function L({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"skeleton",className:(0,C.cn)("bg-accent animate-pulse rounded-md",e),...r})}function F({userId:e}){let{videos:s,loading:n}=function(e){let[t,r]=(0,d.useState)([]),[s,n]=(0,d.useState)(!0),a=(0,T.createClient)();return(0,d.useEffect)(()=>{let t;return(async()=>{let{data:s,error:o}=await a.from("videos").select(`
          *,
          conversion_jobs (*)
        `).eq("user_id",e).order("created_at",{ascending:!1});!o&&s&&r(s),n(!1),t=a.channel("video_changes").on("postgres_changes",{event:"*",schema:"public",table:"videos",filter:`user_id=eq.${e}`},e=>{var t;console.log("[v0] Video change:",e),"INSERT"===(t=e).eventType?a.from("videos").select(`
            *,
            conversion_jobs (*)
          `).eq("id",t.new.id).single().then(({data:e})=>{e&&r(t=>[e,...t])}):"UPDATE"===t.eventType?r(e=>e.map(e=>e.id===t.new.id?{...e,...t.new}:e)):"DELETE"===t.eventType&&r(e=>e.filter(e=>e.id!==t.old.id))}).on("postgres_changes",{event:"*",schema:"public",table:"conversion_jobs"},e=>{var t;console.log("[v0] Conversion job change:",e),t=e,r(e=>e.map(e=>{if(e.id===t.new?.video_id||e.id===t.old?.video_id){if(t.new?.video_id||t.old?.video_id,"UPDATE"===t.eventType)return{...e,conversion_jobs:e.conversion_jobs?.map(e=>e.id===t.new.id?{...e,...t.new}:e)};if("INSERT"===t.eventType)return{...e,conversion_jobs:[...e.conversion_jobs||[],t.new]};if("DELETE"===t.eventType)return{...e,conversion_jobs:e.conversion_jobs?.filter(e=>e.id!==t.old.id)}}return e}))}).subscribe()})(),()=>{t&&a.removeChannel(t)}},[e]),{videos:t,loading:s}}(e);return n?(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsxs)("div",{className:"glass rounded-xl overflow-hidden",children:[(0,t.jsx)(L,{className:"aspect-video w-full"}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsx)(L,{className:"h-6 w-3/4"}),(0,t.jsx)(L,{className:"h-4 w-1/2"}),(0,t.jsx)(L,{className:"h-2 w-full"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(L,{className:"h-10 w-full"}),(0,t.jsx)(L,{className:"h-10 w-full"})]})]})]},e))}):s&&0!==s.length?(0,t.jsx)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(e=>(0,t.jsx)($,{video:e},e.id))}):(0,t.jsxs)("div",{className:"glass rounded-2xl p-12 text-center",children:[(0,t.jsx)(r.VideoIcon,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground opacity-50"}),(0,t.jsx)("h3",{className:"mb-2 text-xl font-semibold",children:"No videos yet"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Upload your first video to get started"})]})}e.s(["VideoListRealtime",()=>F],69020)},66423,e=>{"use strict";var t=e.i(43476),r=e.i(27484),s=e.i(43531);function n(){let{isLoaded:e}=(0,r.useFFmpeg)();return e?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-500 bg-green-500/10 px-3 py-2 rounded-lg border border-green-500/20",children:[(0,t.jsx)(s.Check,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Video converter ready"})]}):null}e.s(["FFmpegStatus",()=>n])}]);